rules_version = '2';

// ðŸ”¥ FIREBASE STORAGE SECURITY RULES
// ProteÃ§Ã£o de upload/download de arquivos
// Ãšltima atualizaÃ§Ã£o: 10 de Novembro de 2025

service firebase.storage {
  match /b/{bucket}/o {
    
    // ========================================
    // PASTA PÃšBLICA DA COMUNIDADE
    // ========================================
    match /community/{fileName} {
      // âœ… Leitura: Qualquer pessoa pode visualizar
      allow read: if true;
      
      // âœ… Escrita: Apenas usuÃ¡rios autenticados
      // RestriÃ§Ãµes:
      // - MÃ¡ximo 10MB por arquivo
      // - Apenas imagens (jpg, png, gif, webp)
      allow write: if request.auth != null
                   && request.resource.size < 10 * 1024 * 1024
                   && request.resource.contentType.matches('image/.*');
    }
    
    // ========================================
    // PASTA PRIVADA DE USUÃRIOS
    // ========================================
    match /users/{userId}/{allPaths=**} {
      // âœ… Leitura/Escrita: Apenas o prÃ³prio usuÃ¡rio
      // RestriÃ§Ãµes:
      // - MÃ¡ximo 10MB por arquivo
      allow read, write: if request.auth != null 
                         && request.auth.uid == userId
                         && request.resource.size < 10 * 1024 * 1024;
    }
    
    // ========================================
    // PASTA DE AVATARES
    // ========================================
    match /avatars/{userId} {
      // âœ… Leitura: Qualquer pessoa pode ver avatares
      allow read: if true;
      
      // âœ… Escrita: Apenas o prÃ³prio usuÃ¡rio
      // RestriÃ§Ãµes:
      // - MÃ¡ximo 2MB (avatares menores)
      // - Apenas imagens
      allow write: if request.auth != null 
                   && request.auth.uid == userId
                   && request.resource.size < 2 * 1024 * 1024
                   && request.resource.contentType.matches('image/.*');
    }
    
    // ========================================
    // BLOQUEIO PADRÃƒO
    // ========================================
    // Qualquer caminho nÃ£o especificamente permitido acima Ã© BLOQUEADO
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
